{% extends "base.html" %}

{% block css %}
  <link rel="stylesheet" type="text/css" href="../static/styles/about.css">
  <link rel="stylesheet" type="text/css" href="../static/styles/about_responsive.css">
{% endblock %}

{% block pagescripts %}
	{% if script is not none %}
		{{ script | safe }}
    {% endif %}
{% endblock %}

{% block title %}Compare{% endblock %}

{% block body %}
<div class="super_container">
    
    <!-- Home -->

    <div class="home">
        <div class="home_background parallax-window" data-parallax="scroll" data-image-src="../static/images/about_info.jpg" data-speed="0.8"></div>
        <div class="container">
            <div class="row">
                <div class="col">
                    <div class="home_content">
                        <div class="home_content_inner">
                            <div class="home_title">My Portfolio</div>
                            <div class="home_breadcrumbs">
                                <ul>
                                    <li>Welcome, {{ user.first_name }}!</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Header -->

        <header class="header">

            <!-- Top Bar -->
            <div class="top_bar">
                <div class="container">
                    <div class="row">
                        <div class="col">
                            <div class="top_bar_container d-flex flex-row align-items-center justify-content-start">
                                <div class="logo_container">
                                    <div class="logo">
                                        <a href="{% url 'my_portfolio' %}">
                                            <div class="logo_line_1"><span>in</span>vest</div>
                                            <div class="logo_line_2">FutureSight</div>
                                            <div class="logo_img"><img src="../static/images/logo.png" alt=""></div>
                                        </a>
                                    </div>
                                </div>
                                <div class="top_bar_content ml-auto">
                                    <div class="main_menu_social">
                                        <ul>
                                            <li><a href="#"><i class="fa fa-twitter" aria-hidden="true"></i></a></li>
                                            <li><a href="#"><i class="fa fa-facebook" aria-hidden="true"></i></a></li>
                                            <li><a href="#"><i class="fa fa-reddit-alien" aria-hidden="true"></i></a></li>
                                            <li><a href="#"><i class="fa fa-behance" aria-hidden="true"></i></a></li>
                                            <li><a href="#"><i class="fa fa-instagram" aria-hidden="true"></i></a></li>
                                        </ul>
                                    </div>
                                </div>
                                <div class="burger">
                                    <i class="fa fa-bars" aria-hidden="true"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>      
            </div>

            <!-- Main Menu -->
            <div class="main_menu">
                <div class="container">
                    <div class="row">
                        <div class="col">
                            <div class="main_menu_container d-flex flex-row align-items-center justify-content-start">
                                <div class="main_menu_content">
                                    <ul class="main_menu_list">
                                        <li><a href="{% url 'my_portfolio' %}">home
                                            <svg version="1.1" id="Layer_4" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
                                                 width="9px" height="5px" viewBox="0 0 9 5" enable-background="new 0 0 9 5" xml:space="preserve">
                                                <g>
                                                    <polyline class="arrow_d" fill="none" stroke="#FFFFFF" stroke-miterlimit="10" points="0.022,-0.178 4.5,4.331 9.091,-0.275   "/>
                                                </g>
                                            </svg>
                                        </a></li>
                                        <li><a href="{% url 'compare' %}">compare
                                            <svg version="1.1" id="Layer_4" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
                                                 width="9px" height="5px" viewBox="0 0 9 5" enable-background="new 0 0 9 5" xml:space="preserve">
                                                <g>
                                                    <polyline class="arrow_d" fill="none" stroke="#FFFFFF" stroke-miterlimit="10" points="0.022,-0.178 4.5,4.331 9.091,-0.275   "/>
                                                </g>
                                            </svg>
                                        </a></li>
                                        <li><a href="{% url 'portfolios' %}">my portfolios
                                            <svg version="1.1" id="Layer_15" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
                                                 width="9px" height="5px" viewBox="0 0 9 5" enable-background="new 0 0 9 5" xml:space="preserve">
                                                <g>
                                                    <polyline class="arrow_d" fill="none" stroke="#FFFFFF" stroke-miterlimit="10" points="0.022,-0.178 4.5,4.331 9.091,-0.275   "/>
                                                </g>
                                            </svg>
                                        </a></li>
                                    </ul>
                                </div>
                                <div class="main_menu_contact ml-auto" style="margin-right: 20px;">
                                    <div class="main_menu_search">
                                        <div class="main_menu_search_button">
                                            <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 512 512" enable-background="new 0 0 512 512" width="15px" height="15px">
                                                <g>
                                                <path class="mag_path" d="M495,466.2L377.2,348.4c29.2-35.6,46.8-81.2,46.8-130.9C424,103.5,331.5,11,217.5,11C103.4,11,11,103.5,11,217.5   S103.4,424,217.5,424c49.7,0,95.2-17.5,130.8-46.7L466.1,495c8,8,20.9,8,28.9,0C503,487.1,503,474.1,495,466.2z M217.5,382.9   C126.2,382.9,52,308.7,52,217.5S126.2,52,217.5,52C308.7,52,383,126.3,383,217.5S308.7,382.9,217.5,382.9z" fill="#f4f4f8"/>
                                                </g>
                                            </svg>
                                        </div>
                                        <div class="main_menu_search_content">
                                            <!-- Insert link to stocks here -->
                                            <form action="/">  
                                                <input class="search_input" type="search" placeholder="Ticker" required="required">
                                            </form>
                                        </div>
                                    </div>
                                </div>
                                <div class="link_button link_button_4 elements_button"><a href="{% url 'logout' %}">logout</a></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Menu -->

            <div class="menu">
                <div class="menu_register_login">
                    <div class="container">
                        <div class="row">
                            <div class="col">
                                <div class="menu_register_login_content d-flex flex-row align-items-center justify-content-end">
                                    <div class="register"><a href=#>sign up</a></div>
                                    <div class="login"><a href="{% url 'login' %}">login</a></div>
                                </div>
                            </div>
                        </div>
                    </div>
                        
                </div>
                <ul class="menu_list">
                    <li class="menu_item">
                        <div class="container">
                            <div class="row">
                                <div class="col">
                                    <a href="#">home</a>
                                </div>
                            </div>
                        </div>
                    </li>
                    <li class="menu_item">
                        <div class="container">
                            <div class="row">
                                <div class="col">
                                    <a href="about.html">about us</a>
                                </div>
                            </div>
                        </div>
                    </li>
                    <li class="menu_item">
                        <div class="container">
                            <div class="row">
                                <div class="col">
                                    <a href="listings.html">services</a>
                                </div>
                            </div>
                        </div>
                    </li>
                    <li class="menu_item">
                        <div class="container">
                            <div class="row">
                                <div class="col">
                                    <a href="news.html">portfolio</a>
                                </div>
                            </div>
                        </div>
                    </li>
                    <li class="menu_item">
                        <div class="container">
                            <div class="row">
                                <div class="col">
                                    <a href="contact.html">blog</a>
                                </div>
                            </div>
                        </div>
                    </li>
                    <li class="menu_item">
                        <div class="container">
                            <div class="row">
                                <div class="col">
                                    <a href="contact.html">contact</a>
                                </div>
                            </div>
                        </div>
                    </li>
                </ul>
            </div>
        </header>
    </div>
    
    <!-- Features -->
    <div class="features">
        <div class="container">
            <div class="row">
                <div class="col-lg-12 features_col">
                    <div class="features_content">
                        <div class="section_title_container">                           
                            <div>
                                <form>

                                    <div class="text-center">
                                        <div class="row">
                                            <div class="col-lg-12">
                                                <button id="addRow" type="button" class="btn btn-info">Add Stocks</button>
                                                <input type="submit" class="btn btn-info" value="Forecast" name="forecast" id="forecast"> 
                                                <input type="submit" class="btn btn-info" value="Optimize" name="optimize" id="optimize">
                                            </div>
                                        </div><br>
                                        <div id="test" class="row" style="margin:5px">
                                            <div class="col-lg-6">
                                                <input type="text" id="stock_name" name="stock_name" class="form-control m-input stock" placeholder="Enter Stock Name/Ticker" list="stocks">
                                                <datalist id="stocks">
                                                    <div id="options"></div>
                                                </datalist>
                                            </div>
                                            <div class="col-lg-6">
                                                <button id="removeRow" type="button" class="btn btn-danger">Remove</button>
                                            </div>
                                        </div>
                                        <div id="newRow"></div>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Graph of predicted returns -->

    <div class="info">
        <div class="info_background parallax-window" data-parallax="scroll" data-image-src="../static/images/about_info.jpg" data-speed="0.8"></div>
        <div class="container">
            <div class="row">
                <div class="col">
                    <div class="section_title_container">
                        <div class="section_subtitle">take a look at your</div>
                        <div class="section_title">Stock Performance At A Glance</div>
                        <div class="info_text"></div>
                        {% if div is None %}
                            <p>Please select stocks</p>
                        {% else %}
                            {{ div | safe }}
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Table of forecasted stocks -->

    <div class="test_faq">
        <div class="container">
            <div class="row">
                <div class="col-lg-12 test_faq_col">
                    
                    <!-- FAQ -->

                    <div class="faq">
                        <div class="section_title_container">
                            <div class="section_subtitle">take a look at your</div>
                            <div class="section_title">Forecast of Chosen Stocks</div>
                        </div>
                        
                        <!-- Accordions -->
                        <div class="elements_accordions">

                            <div class="accordion_container">
                                <div class="accordion d-flex flex-row align-items-center active"><div>Selected Stocks</div></div>
                                <div class="accordion_panel">

                                    {% if df is None %}
                                    <h3 style='text-align: center; padding: 18px;'>Please select stocks</h3>
                                    {% else %}

                                    <table class="table">
                                        <thead class="thead-inverse">
                                          <tr>
                                            <th style="width: 70%;">Stock Name</th>
                                            <th style="width: 30%;">Predicted Returns for next quarter</th>
                                          </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                            <td>
                                                FACEBOOK INC. (FB)
                                            </td>
                                            <td>
                                                3.44%
                                            </td>
                                            </tr>
                                            <tr>
                                            <td>
                                                ALPHABET INC (GOOGL)
                                            </td>
                                            <td>
                                                5.40%
                                            </td>
                                            </tr>
                                    
                                            {% for stock in df %}
                                                <tr>
                                                <td>
                                                    {{ stock.stock_name }}
                                                </td>
                                                <td>
                                                    {{ stock.forecast_return }}
                                                </td>
                                                </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        //filter selected stocks to ticker only
        function stringFilter(str){
            let ans = "";
            let i = str.split("(");
            i = i[1];
            let j = i.split(")");
            ans = j[0];
            return ans;
        };

        //JQuery for "Forecast" button: Pass user input idArray to backend, return forecasted results in chart and table 
        $(document).ready(function(){
            $("#forecast").click(function(e){
                e.preventDefault();
                let idArr = [];
                $(".stock").each(function(){
                    //filter only stock ticker to store in list
                    let ans = $(this).val();
                    let i = ans.split("(");
                    i = i[1];
                    let j = i.split(")");
                    ans = j[0];
                    idArr.push(ans);
                });
                console.log(idArr)
                // Join array elements and display in alert
                // alert(idArr.join("\n"));
                // send a request post to backend the array of tickers
                $.post("/my_portfolio/", {"idArr": idArr}, function(result){
                    // This function activates once response from backend returns
                    console.log("the backend results are", result);
                    let beResults = result.data;
                    localStorage.setItem('stock_dict', beResults) // Store stock_dic forecasted returns to local browser storage
                    window.location="/my_portfolio/"
                });
            });
        });

        //JQuery for "Optimize" button: Pass user input idArray to backend, runs ML model, returns user optimized figures and directs users to "optimize.html" page
        {% comment %} $(document).ready(function(){
            $("#optimize").click(function(){
                let idArr = [];
                $(".stock").each(function(){
                    //filter only stock ticker to store in list
                    let ans = $(this).val();
                    let i = ans.split("(");
                    i = i[1];
                    let j = i.split(")");
                    ans = j[0];
                    idArr.push(ans);
                });
                
                // Join array elements and display in alert
                // alert(idArr.join("\n"));
                
                // send a request post to backend the array of tickers
                $.post("/my_portfolio/", {idArr: idArr}, function(result){
                    // This function activates once response from backend returns
                    console.log("the backend results are", result);
                    let beResults = result.data.mlOutput;
                    localStorage.setItem('mlOutput', beResults) // Store data to local browser storage
                    window.location="/my_portfolio/optimize" // Jump to optimize.html once backend returns results   
                    window.location.assign('/my_portfolio/optimize')           
                });
            });
        }); {% endcomment %}
    </script>
    <script>
    $(document).ready(function(){
        //datalist options
        let stocks = ['AMERICAN AIRLINES GROUP INC (AAL)', 'ADVANCE AUTO PARTS INC (AAP)', 'AFLAC INC (AFL)', 'ASSURANT INC (AIZ)', 'AKAMAI TECHNOLOGIES INC (AKAM)', 'AMERIPRISE FICIAL INC (AMP)', 'AUTOZONE INC (AZO)', 'BLACKROCK INC (BLK)', 'BROADVISION INC (BVSN)', 'CBRE GROUP INC (CBG)', 'CRANE CO (CR)', 'CONVERGYS CORP (CVG)', 'DELTA AIR LINES INC (DAL)', 'DELUXE CORP (DLX)', 'DYNEGY INC (DYN)', 'E TRADE FICIAL CORP (ETFC)', 'EXPEDIA INC (EXPE)', 'FACEBOOK INC (FB)', 'GENWORTH FICIAL INC (GNW)', 'ALPHABET INC (GOOGL)', 'HCA HEALTHCARE INC (HCA)', 'HARTFORD FICIAL SERVICES (HIG)', 'HOST HOTELS & RESORTS INC (HST)', 'IAC/INTERACTIVECORP (IAC)', 'KB HOME (KBH)', 'LINCOLN NATIONAL CORP (LNC)', 'LOUISIANA-PACIFIC CORP (LPX)', 'SOUTHWEST AIRLINES (LUV)', 'METLIFE INC (MET)', 'NETFLIX INC (NFLX)', 'NORTHERN TRUST CORP (NTRS)', 'ORACLE CORP (ORCL)', 'PRICELINE GROUP INC (PCLN)', 'PRINCIPAL FICIAL GRP INC (PFG)', 'PULTEGROUP INC (PHM)', 'PRUDENTIAL FICIAL INC (PRU)', 'ROBERT HALF INTL INC (RHI)', 'REALOGY HOLDINGS CORP (RLGY)', 'SPRINT CORP (S)', 'SEARS HOLDINGS CORP (SHLD)', 'SNAP-ON INC (SNA)', 'TIFFANY & CO (TIF)', 'TYSON FOODS INC  -CL A (TSN)', 'UNUM GROUP (UNM)', 'UNITED RENTALS INC (URI)', 'VIAVI SOLUTIONS INC (VIAV)'];
        let option = "";
        for (let i = 0; i < stocks.length; i++)
        {
            option += '<option value="' + stocks[i] + '">';
        }
        $("#options").html(option);
     
        //add new row
        $("#addRow").click(function () {
        let html = '';
        html +='<div id="test" class="row" style="margin:5px">';
        html += '<div class="col-lg-6">';
        html +=     '<input type="text" id="stock_name" name="stock_name" class="form-control m-input stock" placeholder="Enter Stock Name/Ticker" list="stocks">';
        html +=     '<datalist id="stocks">';
        html +=     '<div id="options"></div>';
        html +=     '</datalist>';
        html += '</div>';
        html += '<div class="col-lg-6">';
        html +=     '<button id="removeRow" type="button" class="btn btn-danger">Remove</button>';
        html += '</div>'
        html +='</div>' 
        $('#newRow').append(html);
        });
        
        //remove row
        $(document).on('click', '#removeRow', function () {
            $(this).closest('#test').remove();
        });

        //add row by pressing "enter"
        var key = document.getElementById("stock_name");
        key.addEventListener("keypress", function(event) {
            if (event.keyCode === 13) {
                event.preventDefault();
                document.getElementById("addRow").click();
            };
        });
    });
    </script>
    
{% endblock %}
